<!DOCTYPE html>
<meta charset="utf-8">
    
<script src="http://d3js.org/d3.v4.min.js"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>
<script src="https://unpkg.com/topojson-client@3"></script>
<script src="https://d3js.org/d3-color.v1.min.js"></script>
<script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="../data/tooltip.js"> </script>
<script src="../data/box.js"> </script>


<!-- jQuery library -->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>

<!-- Popper -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>

<!-- Latest compiled and minified Bootstrap JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

<!-- Initialize Bootstrap functionality -->
<script>
    // Initialize tooltip component
    $(function () {
      $('[data-toggle="tooltip"]').tooltip()
      })
      
      // Initialize popover component
      $(function () {
        $('[data-toggle="popover"]').popover()
        })
    </script>

<style type="text/css">
   
.container {
   display: block;
   margin-left: auto;
   margin-right: auto;
   width: 75%;
}
#header{
    width: 100%;
    text-align: center;
}
.data {
    font-size: 16px;
    font-family: sans-serif;
    text-decoration: none;
}
img{
    display: inline-block;
    height: 150px;
    margin: 0 auto;
}

.medals{
    margin-left: auto;
    margin-right: auto;
}
.tooltip{
    background-color:rgba(0,0,0,0.5);
    color:#fff;
    padding: 10px;
    -webkit-border-radius:10px;
    -moz-border-radius:10px;
    border-radius:10px; }
.my-button {
    display: inline-block;
    margin: 1px; /* space between buttons */
    background: black; /* background color */
    color: white; /* text color */
    font-size: 1em;
    font-family: sans-serif;
    border-radius: 40px; /* rounded corners */
    padding: 8px 16px; /* space around text */
    -moz-transition: all 0.2s;
    -webkit-transition: all 0.2s;
    transition: all 0.2s;
}
.my-button:hover {
    background: grey;
    color: white;
}

.my-button1 {
    display: inline-block;
    margin: 1px; /* space between buttons */
    background: black; /* background color */
    color: white; /* text color */
    font-size: 1em;
    font-family: sans-serif;
    border-radius: 40px; /* rounded corners */
    padding: 8px 16px; /* space around text */
    -moz-transition: all 0.2s;
    -webkit-transition: all 0.2s;
    transition: all 0.2s;
}
.my-button1:hover {
    background: #356ec6;
    color: white;
}
.my-button2 {
    display: inline-block;
    margin: 1px; /* space between buttons */
    background: black; /* background color */
    color: white; /* text color */
    font-size: 1em;
    font-family: sans-serif;
    border-radius: 40px; /* rounded corners */
    padding: 8px 16px; /* space around text */
    -moz-transition: all 0.2s;
    -webkit-transition: all 0.2s;
    transition: all 0.2s;
}
.my-button2:hover {
    background: gold;
    color: white;
}
.my-button3 {
    display: inline-block;
    margin: 1px; /* space between buttons */
    background: black; /* background color */
    color: white; /* text color */
    font-size: 1em;
    font-family: sans-serif;
    border-radius: 40px; /* rounded corners */
    padding: 8px 16px; /* space around text */
    -moz-transition: all 0.2s;
    -webkit-transition: all 0.2s;
    transition: all 0.2s;
}
.my-button3:hover {
    background: white;
    color: black;
}
.my-button4 {
    display: inline-block;
    margin: 1px; /* space between buttons */
    background: black; /* background color */
    color: white; /* text color */
    font-size: 1em;
    font-family: sans-serif;
    border-radius: 40px; /* rounded corners */
    padding: 8px 16px; /* space around text */
    -moz-transition: all 0.2s;
    -webkit-transition: all 0.2s;
    transition: all 0.2s;
}
.my-button4:hover {
    background: green;
    color: white;
}
.my-button5 {
    display: inline-block;
    margin: 1px; /* space between buttons */
    background: black; /* background color */
    color: white; /* text color */
    font-size: 1em;
    font-family: sans-serif;
    border-radius: 40px; /* rounded corners */
    padding: 8px 16px; /* space around text */
    -moz-transition: all 0.2s;
    -webkit-transition: all 0.2s;
    transition: all 0.2s;
}
.my-button5:hover {
    background: red;
    color: white;
}

body {
  /*font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;*/
  font-family: sans-serif;
}
.box {
  font: 10px sans-serif;
}
.box line,
.box rect,
.box circle {
  fill: #f4d953;
  stroke: #000;
  stroke-width: 1px;
}
.box .center {
  stroke-dasharray: 3,3;
}
.box .outlier {
  fill: none;
  stroke: #000;
}
.axis {
  font: 12px sans-serif;
}
 
.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}
 
.x.axis path { 
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

// sports over time



* {
    margin: 0;
    padding: 0;
}
body {
    background: #fff;
    font-family: sans-serif;
    
}

#container{
    margin: 0 auto;
    position: relative;
    width:800px;
    overflow: visible;
}


.Sportssvg {
    width:800px;
    height:400px;
    overflow: visible;
    position:absolute;
}

.tooltipSport{
  position: absolute;
               text-align: center;
               width: 120px;
               height: 40px;
               padding: 2px;
               font: 12px sans-serif;
               background: lightsteelblue;
               border: 0px;
               border-radius: 8px;
               pointer-events: none; 
}

html {
    width: : 800%;
    height: 400%;
    margin-bottom: 0.01em;
    margin-right: 0.01em;
}

.grid .tick {
    stroke: lightgrey;
    opacity: 0.3;
    shape-rendering: crispEdges;
}
.grid path {
    stroke-width: 0;
}


#tag {
    color: white;
    background: #FA283D;
    width: 150px;
    position: absolute;
    display: none;
    padding:3px 6px;
    margin-left: -80px;
    font-size: 11px;
}



#tag:before {
    border: solid transparent;
    content: ' ';
    height: 0;
    left: 50%;
    margin-left: -5px;
    position: absolute;
    width: 0;
    border-width: 10px;
    border-bottom-color: #FA283D;
    top: -20px;
}
</style>



<body>
    <a href="https://www.kaggle.com/heesoo37/120-years-of-olympic-history-athletes-and-results"  class="data" > Data Source </a>

    <div class="container" align= "center">

    
    <div id="header">
        <img src="Ringscopy3.jpg" />
    </div>
       
       <button type="button" class="my-button" data-toggle="tooltip" title="Explore the countries that win the most!"   onclick=" toggle_visibility('stacked'); toggled();"> Medals </button>
       
       <button type ="button" class= "my-button1" data-toggle="tooltip" title="See which countries joined the Olympics from 1896 to 2016" onclick="toggle_visibility('part')" >Country Participation</button>

       <button type="button" class= "my-button2" data-toggle="tooltip" title="Compare athlete height, weight, and age between sports" onclick="toggle_visibility('athlete');">Athlete Profiles</button>
       
       <button type="button" class= "my-button3"  data-toggle="tooltip" title= "Are countries better at summer Olympics or winter?" onclick="toggle_visibility('ws');">Seasonal Winnings</button>
       
       <button type="button"  class= "my-button4"  data-toggle="tooltip" title= "Explore when each sport was added, or discontinued, from the Olympics over time" onclick="toggle_visibility('sports');">Sports Over Time</button>
       
       <button type="button"  class= "my-button5"  data-toggle="tooltip" title= "Take a look at how gender has varied throughout Olympic history" onclick="toggle_visibility('demo');">Gender History</button>
       
       <div class="medals">
           
           <svg id="stacked" style="display:none;" width="1000" height="600" x=0 y=600> </svg>
           
           <svg id="ws" style="display:none;" width="1240" height="600"> </svg>
           <svg id="sports" style="display:none;" width="4000" height="2760"> </svg>


           <div id=titleDiv style="display:none;">
               <input id="slider" type="range" value="0" min="0" max="34" />
               <span id="year"  > </span></div><svg id="part"  style="display:none;" width="1000" height= "550">
               </svg>
               
               
               <span id='tooltipDem' style='position:absolute;padding:5px; left:980px; top: 250px;'></span>
               <svg id="demo" style="display:none;" width="1000" height="600"> 
               
               <div id="athlete" style="display:none;" width="1000" height="600">
                   <label for="Dropdown1Box">Select a Sport to Compare</label>
                   <div id="Dropdown1Box"> </div>
                   <label for="Dropdown2Box">Select a Sport to Compare</label>
                   <div id="Dropdown2Box"> </div>
                   <label for="Dropdown3Box">Select a Metric to Compare</label>
                   <div id="Dropdown3Box"> </div>
              </div>
               
       </div>
       
       
    </div>


</body>

<script>
  


  
function toggle_visibility(id) {
  var listOfButtons = ['athlete','stacked','part','demo', 'ws', 'sports'];
  //var listOfButtons = ['stacked','part','demo','sports','ws','athlete'];
  for (i = 0; i < listOfButtons.length; i++) { 
  text = listOfButtons[i];
  var e = document.getElementById(text);
    if(text== id)
    e.style.display = 'block';
    else
    e.style.display = 'none';
}
  if (id == 'part'){
  document.getElementById('titleDiv').style.display = 'block';
  }
  else {
  document.getElementById('titleDiv').style.display = 'none';
  }
}


function toggled(){//STACKED BAR - FINAL
d3.selectAll("#stacked > *").remove();
var Ssvg = d3.select("#stacked"),
margin = {top: 10, right: 30, bottom: 40, left: 115},
width = +Ssvg.attr("width") - margin.left - margin.right,
height = +Ssvg.attr("height") - margin.top - margin.bottom,
g = Ssvg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");
var y = d3.scaleBand()      // x = d3.scaleBand()
.rangeRound([0, height])  // .rangeRound([0, width])
.paddingInner(0.2)
.align(0.1);
var formatPercent = d3.format(",d");
var x = d3.scaleLinear()    // y = d3.scaleLinear()
.rangeRound([0, width]);  // .rangeRound([height, 0]);
var z = d3.scaleOrdinal()
//.range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);
.range(["#bc8f54", "#dbdbdb", "#ffdc84"]);
d3.csv("../data/top_20_stacked_bar.csv", function(d, i, columns) {
       for (i = 1, t = 0; i < columns.length; ++i) t += d[columns[i]] = +d[columns[i]];
       d.total = t;
       return d;
       }, function(error, data) {
       if (error) throw error;
       var keys = data.columns.slice(1);
       data.sort(function(a, b) { return b.total - a.total; });
       
       y.domain(data.map(function(d) { return d.Country; }));          // x.domain...
       x.domain([0, d3.max(data, function(d) { return d.total; })]).nice();  // y.domain...
       z.domain(keys);
       
       var stackdata = d3.stack().keys(keys)(data);
       
       var bar = g.selectAll("g")
       .data(d3.stack().keys(keys)(data))
       .enter().append("g")
       .attr("fill", function(d) {return z(d.key); })
       .attr("class", "bar");
       
       bar.selectAll(".rect")
       .data(function(d) { return d; })
       .enter().append("rect")
       .attr("y", function(d) { return y(d.data.Country); })
       .attr("height", y.bandwidth())
       .on("mouseover", function() { tooltip.style("display", null); })
       .on("mouseout", function() { tooltip.style("display", "none"); })
       .on("mousemove", function(d) {
           var xPosition = d3.mouse(this)[0] + 95;
           var yPosition = d3.mouse(this)[1] - 15;
           tooltip.attr("transform", "translate(" + xPosition + "," + yPosition + ")");
           // tooltip.select("text").text(d[0]) - x(d[1]);
           tooltip.select("text").text(d[1] - d[0]);
           })
       .transition().ease(d3.easeQuadOut).duration(3000).delay(0)
       .attr("x", function(d) {return x(d[0]) })
       .attr("width", function(d) { return x(d[0] == 0 ? d.data["Bronze Count"]
                                             : d[0] == d.data["Bronze Count"] ? d.data["Silver Count"] : d.data["Gold Count"]);}); 
        bar.selectAll(".rect")
       .data(function(d) { return d; })
       .enter().append("text")
       .attr("x", 5)
       .attr("y", function(d) { return y(d.data.Country) + y.bandwidth()/2 + 3; })
       .text(0)
       .style("fill", "black")
       .transition().ease(d3.easeQuadOut).duration(3000).delay(0)
       .attr("x", function(d) { return x(d.data.total);})
       .tween("text", function(d) {
              var i = d3.interpolateNumber(0, d.data.total);
              var node = this;
              return function(t) {
              d3.select(node).text(formatPercent(i(t)));
              };
              }); 

       g.append("g")
       .attr("class", "axis")
       .attr("transform", "translate(0,0)")
       .style("font", "18px sans-serif")//  .attr("transform", "translate(0," + height + ")")
       .call(d3.axisLeft(y));                  //   .call(d3.axisBottom(x));
       
       var legend = g.append("g")
       .attr("font-family", "sans-serif")
       .attr("font-size", 10)
       .attr("text-anchor", "end")
       .selectAll("g")
       .data(keys.slice().reverse())
       .enter().append("g")
       //.attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });
       .attr("transform", function(d, i) { return "translate(-50," + (300 + i * 20) + ")"; });
       legend.append("rect")
       .attr("x", 860)
       .attr("width", 25)
       .attr("height", 25)
       .attr("fill", z);
       legend.append("text")
       .attr("x", 850)
       .attr("y", 9.5)
       .attr("dy", "0.32em")
       .style("font", "20px sans-serif")
       .text(function(d) { return d; })
       // Prep the tooltip bits, initial display is hidden
       var tooltip = Ssvg.append("g")
       .attr("class", "tooltip")
       .style("display", "none");
       
       tooltip.append("rect")
       .attr("width", 30)
       .attr("height", 20)
       .attr("fill", "white")
       .style("opacity", 0.7);
       tooltip.append("text")
       .attr("x", 15)
       .attr("dy", "1.2em")
       .style("text-anchor", "middle")
       .attr("font-size", "14px")
       .attr("font-weight", "bold");
       
       }); };
       
    
////  PARTICIPATION ////
var width=1000, height=550;
   
var Csvg = d3.select("#part")
   .append("svg")
   .attr("width", width)
   .attr("height", height);
   
var projectionP = d3.geoMercator()
   .scale(130)
   .translate( [width /2, height / 1.5]);
   
var colorsP = d3.scaleQuantize()
   .range(["#ccc",
           "#356ec6"]);
           
var boxP = d3.select("#part")

boxP.append("text")
.attr("x", 0)
.attr("y", 350)
.attr("dy", ".35em")
.text("Use the slide bar to")
boxP.append("text")
.attr("x", 0)
.attr("y", 365)
.attr("dy", ".35em")
.text("move through Olympic years.")
boxP.append("text")
.attr("x", 0)
.attr("y", 380)
.attr("dy", ".35em")
.text("The countries in blue participated")
boxP.append("text")
.attr("x", 0)
.attr("y", 395)
.attr("dy", ".35em")
.text("during that Olympic year, while the")
boxP.append("text")
.attr("x", 0)
.attr("y", 410)
.attr("dy", ".35em")
.text("countries in grey did not.")
           
//var tooltip2 = d3.select('#part')
   //.append('div')
   //.attr('class', 'hidden tooltip2');
   
var pathP = d3.geoPath().projection(projectionP);
d3.csv("../data/country_participation3.csv", function(data){
      var world2;
      var listyears = Object.keys(data[0])
      var arr=[];
      data.forEach(function(d){
        d.region = d['region'];
        d.id = d['id'];
        arr[d.id]=d.region; }); 
     
      
      d3.json("../data/world.json", function(json){
              var first = listyears[0];
              d3.select('#year').html(first);
              d3.select('#slider').on("input", function(){
                                      updateViz(+this.value);
                                      });
              for (var i = 0; i < data.length; i++) {
              // Find the name of the region in csv file
              var dataState = data[i].id;
              for (var j = 0; j< json.features.length; j++){
              var jsonState = json.features[j].id;
              if (dataState == jsonState) {
              json.features[j].properties.tab =  Object.values(data[i]);
              //stop because result found
              break;
              }
              }
              }
                          
              Csvg.selectAll("path")
              .data(json.features)
              .enter()
              .append("path")
              .attr("d", pathP)
              .call(d3.helper.tooltip(
                function(d){
                return "<b>"+arr[d.id]+ "</b>";
                }));
              
              world2 = json;
              drawMap(0);
        }); // End of "d3.json("regions.json", function(json){"
        //update elements
        function updateViz(val){
        d3.select('#year').html(listyears[val]);
        drawMap(val);
        };
        // Draw the map
        function drawMap(currentYear){
        var nbr;
       
            //Set input domain for color scale
            colorsP.domain([
                         d3.min(data, function(x) { return parseFloat(Object.values(x)[currentYear]);}),
                         d3.max(data, function(x) { return parseFloat(Object.values(x)[currentYear]);})
                         ]);
            carte = Csvg.selectAll("path")
            .data(world2.features);
            carte
            .attr('class', function(d) {
                return 'Countries' + d.id;
                })
            .attr('d', pathP)
            .style("fill", function(d) {
                 // get value found above
                 var tab = d.properties.tab;
                 if (tab) {
                 return colorsP(tab[currentYear]);
                 } else {
                 // if no value then color with Grey
                 return "#ccc";
                 }
        });
        // fist time of coloring the map
        carte.selectAll("path")
        .enter()
        .data(world2.features)
        .append("path")
        .attr("class", "enter")
        .attr("d", pathP)
        .style("fill", function(d) {
             // get value found above
             var tab = d.properties.tab;
             if (tab) {
             return colorsP(tab[currentYear]);
             } else {
             // if no value then color with Grey
             return "#ccc";
             }
             });
           }; });
           

//////////////////
//SPORTS OVER TIME
//////////////////

var w = 1100;
var h = 3000;


var Sportssvg = d3.selectAll("#sports")
.append("svg")
.attr("width", w)
.attr("height", h)
.attr("class", "svg");


var taskArray =
[
{
"Sport": "Aeronautics",
"id": 1,
"startyear": 1936,
"endyear": 1937,
"id2": 1
},
{
"Sport": "Alpine Skiing",
"id": 1,
"startyear": 1936,
"endyear": 1937,
"id2": 2
},
{
"Sport": "Alpine Skiing",
"id": 2,
"startyear": 1948,
"endyear": 2014,
"id2": 2
},
{
"Sport": "Alpinism",
"id": 1,
"startyear": 1924,
"endyear": 1925,
"id2": 3
},
{
"Sport": "Alpinism",
"id": 2,
"startyear": 1932,
"endyear": 1936,
"id2": 3
},
{
"Sport": "Archery",
"id": 1,
"startyear": 1900,
"endyear": 1908,
"id2": 4
},
{
"Sport": "Archery",
"id": 2,
"startyear": 1920,
"endyear": 1921,
"id2": 4
},
{
"Sport": "Archery",
"id": 3,
"startyear": 1972,
"endyear": 2016,
"id2": 4
},
{
"Sport": "Art Competitions",
"id": 1,
"startyear": 1912,
"endyear": 1913,
"id2": 5
},
{
"Sport": "Art Competitions",
"id": 2,
"startyear": 1920,
"endyear": 1936,
"id2": 5
},
{
"Sport": "Art Competitions",
"id": 3,
"startyear": 1948,
"endyear": 1949,
"id2": 5
},
{
"Sport": "Athletics",
"id": 1,
"startyear": 1896,
"endyear": 1912,
"id2": 6
},
{
"Sport": "Athletics",
"id": 2,
"startyear": 1920,
"endyear": 1936,
"id2": 6
},
{
"Sport": "Athletics",
"id": 3,
"startyear": 1948,
"endyear": 2016,
"id2": 6
},
{
"Sport": "Badminton",
"id": 1,
"startyear": 1992,
"endyear": 2016,
"id2": 7
},
{
"Sport": "Baseball",
"id": 1,
"startyear": 1992,
"endyear": 2008,
"id2": 8
},
{
"Sport": "Basketball",
"id": 1,
"startyear": 1936,
"endyear": 1937,
"id2": 9
},
{
"Sport": "Basketball",
"id": 2,
"startyear": 1948,
"endyear": 2016,
"id2": 9
},
{
"Sport": "Basque Pelota",
"id": 1,
"startyear": 1900,
"endyear": 1901,
"id2": 10
},
{
"Sport": "Beach Volleyball",
"id": 1,
"startyear": 1996,
"endyear": 2016,
"id2": 11
},
{
"Sport": "Biathlon",
"id": 1,
"startyear": 1960,
"endyear": 2014,
"id2": 12
},
{
"Sport": "Bobsleigh",
"id": 1,
"startyear": 1924,
"endyear": 1936,
"id2": 13
},
{
"Sport": "Bobsleigh",
"id": 2,
"startyear": 1948,
"endyear": 1956,
"id2": 13
},
{
"Sport": "Bobsleigh",
"id": 3,
"startyear": 1964,
"endyear": 2014,
"id2": 13
},
{
"Sport": "Boxing",
"id": 1,
"startyear": 1904,
"endyear": 1908,
"id2": 14
},
{
"Sport": "Boxing",
"id": 2,
"startyear": 1920,
"endyear": 1936,
"id2": 14
},
{
"Sport": "Boxing",
"id": 3,
"startyear": 1948,
"endyear": 2016,
"id2": 14
},
{
"Sport": "Canoeing",
"id": 1,
"startyear": 1936,
"endyear": 1937,
"id2": 15
},
{
"Sport": "Canoeing",
"id": 2,
"startyear": 1948,
"endyear": 2016,
"id2": 15
},
{
"Sport": "Cricket",
"id": 1,
"startyear": 1900,
"endyear": 1901,
"id2": 16
},
{
"Sport": "Croquet",
"id": 1,
"startyear": 1900,
"endyear": 1901,
"id2": 17
},
{
"Sport": "Cross Country Skiing",
"id": 1,
"startyear": 1924,
"endyear": 1936,
"id2": 18
},
{
"Sport": "Cross Country Skiing",
"id": 2,
"startyear": 1948,
"endyear": 2014,
"id2": 18
},
{
"Sport": "Curling",
"id": 1,
"startyear": 1924,
"endyear": 1925,
"id2": 19
},
{
"Sport": "Curling",
"id": 2,
"startyear": 1998,
"endyear": 2014,
"id2": 19
},
{
"Sport": "Cycling",
"id": 1,
"startyear": 1896,
"endyear": 1912,
"id2": 20
},
{
"Sport": "Cycling",
"id": 2,
"startyear": 1920,
"endyear": 1936,
"id2": 20
},
{
"Sport": "Cycling",
"id": 3,
"startyear": 1948,
"endyear": 2016,
"id2": 20
},
{
"Sport": "Diving",
"id": 1,
"startyear": 1904,
"endyear": 1912,
"id2": 21
},
{
"Sport": "Diving",
"id": 2,
"startyear": 1920,
"endyear": 1936,
"id2": 21
},
{
"Sport": "Diving",
"id": 3,
"startyear": 1948,
"endyear": 2016,
"id2": 21
},
{
"Sport": "Equestrianism",
"id": 1,
"startyear": 1900,
"endyear": 1901,
"id2": 22
},
{
"Sport": "Equestrianism",
"id": 2,
"startyear": 1912,
"endyear": 1913,
"id2": 22
},
{
"Sport": "Equestrianism",
"id": 3,
"startyear": 1920,
"endyear": 1936,
"id2": 22
},
{
"Sport": "Equestrianism",
"id": 4,
"startyear": 1948,
"endyear": 2016,
"id2": 22
},
{
"Sport": "Fencing",
"id": 1,
"startyear": 1896,
"endyear": 1912,
"id2": 23
},
{
"Sport": "Fencing",
"id": 2,
"startyear": 1920,
"endyear": 1936,
"id2": 23
},
{
"Sport": "Fencing",
"id": 3,
"startyear": 1948,
"endyear": 2016,
"id2": 23
},
{
"Sport": "Figure Skating",
"id": 1,
"startyear": 1908,
"endyear": 1909,
"id2": 24
},
{
"Sport": "Figure Skating",
"id": 2,
"startyear": 1920,
"endyear": 1936,
"id2": 24
},
{
"Sport": "Figure Skating",
"id": 3,
"startyear": 1948,
"endyear": 2014,
"id2": 24
},
{
"Sport": "Football",
"id": 1,
"startyear": 1900,
"endyear": 1912,
"id2": 25
},
{
"Sport": "Football",
"id": 2,
"startyear": 1920,
"endyear": 1928,
"id2": 25
},
{
"Sport": "Football",
"id": 3,
"startyear": 1936,
"endyear": 1937,
"id2": 25
},
{
"Sport": "Football",
"id": 4,
"startyear": 1948,
"endyear": 2016,
"id2": 25
},
{
"Sport": "Freestyle Skiing",
"id": 1,
"startyear": 1992,
"endyear": 2014,
"id2": 26
},
{
"Sport": "Golf",
"id": 1,
"startyear": 1900,
"endyear": 1904,
"id2": 27
},
{
"Sport": "Golf",
"id": 2,
"startyear": 2016,
"endyear": 2017,
"id2": 27
},
{
"Sport": "Gymnastics",
"id": 1,
"startyear": 1896,
"endyear": 1912,
"id2": 28
},
{
"Sport": "Gymnastics",
"id": 2,
"startyear": 1920,
"endyear": 1936,
"id2": 28
},
{
"Sport": "Gymnastics",
"id": 3,
"startyear": 1948,
"endyear": 2016,
"id2": 28
},
{
"Sport": "Handball",
"id": 1,
"startyear": 1936,
"endyear": 1937,
"id2": 29
},
{
"Sport": "Handball",
"id": 2,
"startyear": 1972,
"endyear": 2016,
"id2": 29
},
{
"Sport": "Hockey",
"id": 1,
"startyear": 1908,
"endyear": 1909,
"id2": 30
},
{
"Sport": "Hockey",
"id": 2,
"startyear": 1920,
"endyear": 1921,
"id2": 30
},
{
"Sport": "Hockey",
"id": 3,
"startyear": 1928,
"endyear": 1936,
"id2": 30
},
{
"Sport": "Hockey",
"id": 4,
"startyear": 1948,
"endyear": 2016,
"id2": 30
},
{
"Sport": "Ice Hockey",
"id": 1,
"startyear": 1920,
"endyear": 1936,
"id2": 31
},
{
"Sport": "Ice Hockey",
"id": 2,
"startyear": 1948,
"endyear": 2014,
"id2": 31
},
{
"Sport": "Jeu De Paume",
"id": 1,
"startyear": 1908,
"endyear": 1909,
"id2": 32
},
{
"Sport": "Judo",
"id": 1,
"startyear": 1964,
"endyear": 1965,
"id2": 33
},
{
"Sport": "Judo",
"id": 2,
"startyear": 1972,
"endyear": 2016,
"id2": 33
},
{
"Sport": "Lacrosse",
"id": 1,
"startyear": 1904,
"endyear": 1908,
"id2": 34
},
{
"Sport": "Luge",
"id": 1,
"startyear": 1964,
"endyear": 2014,
"id2": 35
},
{
"Sport": "Military Ski Patrol",
"id": 1,
"startyear": 1924,
"endyear": 1925,
"id2": 36
},
{
"Sport": "Modern Pentathlon",
"id": 1,
"startyear": 1912,
"endyear": 1913,
"id2": 37
},
{
"Sport": "Modern Pentathlon",
"id": 2,
"startyear": 1920,
"endyear": 1936,
"id2": 37
},
{
"Sport": "Modern Pentathlon",
"id": 3,
"startyear": 1948,
"endyear": 2016,
"id2": 37
},
{
"Sport": "Motorboating",
"id": 1,
"startyear": 1908,
"endyear": 1909,
"id2": 38
},
{
"Sport": "Nordic Combined",
"id": 1,
"startyear": 1924,
"endyear": 1936,
"id2": 39
},
{
"Sport": "Nordic Combined",
"id": 2,
"startyear": 1948,
"endyear": 2014,
"id2": 39
},
{
"Sport": "Polo",
"id": 1,
"startyear": 1900,
"endyear": 1901,
"id2": 40
},
{
"Sport": "Polo",
"id": 2,
"startyear": 1908,
"endyear": 1909,
"id2": 40
},
{
"Sport": "Polo",
"id": 3,
"startyear": 1920,
"endyear": 1924,
"id2": 40
},
{
"Sport": "Polo",
"id": 4,
"startyear": 1936,
"endyear": 1937,
"id2": 40
},
{
"Sport": "Racquets",
"id": 1,
"startyear": 1908,
"endyear": 1909,
"id2": 41
},
{
"Sport": "Rhythmic Gymnastics",
"id": 1,
"startyear": 1984,
"endyear": 2016,
"id2": 42
},
{
"Sport": "Roque",
"id": 1,
"startyear": 1904,
"endyear": 1905,
"id2": 43
},
{
"Sport": "Rowing",
"id": 1,
"startyear": 1900,
"endyear": 1912,
"id2": 44
},
{
"Sport": "Rowing",
"id": 2,
"startyear": 1920,
"endyear": 1936,
"id2": 44
},
{
"Sport": "Rowing",
"id": 3,
"startyear": 1948,
"endyear": 2016,
"id2": 44
},
{
"Sport": "Rugby",
"id": 1,
"startyear": 1900,
"endyear": 1901,
"id2": 45
},
{
"Sport": "Rugby",
"id": 2,
"startyear": 1908,
"endyear": 1909,
"id2": 45
},
{
"Sport": "Rugby",
"id": 3,
"startyear": 1920,
"endyear": 1924,
"id2": 45
},
{
"Sport": "Rugby Sevens",
"id": 1,
"startyear": 2016,
"endyear": 2017,
"id2": 46
},
{
"Sport": "Sailing",
"id": 1,
"startyear": 1900,
"endyear": 1901,
"id2": 47
},
{
"Sport": "Sailing",
"id": 2,
"startyear": 1908,
"endyear": 1912,
"id2": 47
},
{
"Sport": "Sailing",
"id": 3,
"startyear": 1920,
"endyear": 1936,
"id2": 47
},
{
"Sport": "Sailing",
"id": 4,
"startyear": 1948,
"endyear": 2016,
"id2": 47
},
{
"Sport": "Shooting",
"id": 1,
"startyear": 1896,
"endyear": 1900,
"id2": 48
},
{
"Sport": "Shooting",
"id": 2,
"startyear": 1906,
"endyear": 1912,
"id2": 48
},
{
"Sport": "Shooting",
"id": 3,
"startyear": 1920,
"endyear": 1924,
"id2": 48
},
{
"Sport": "Shooting",
"id": 4,
"startyear": 1932,
"endyear": 1936,
"id2": 48
},
{
"Sport": "Shooting",
"id": 5,
"startyear": 1948,
"endyear": 2016,
"id2": 48
},
{
"Sport": "Short Track Speed Skating",
"id": 1,
"startyear": 1992,
"endyear": 2014,
"id2": 49
},
{
"Sport": "Skeleton",
"id": 1,
"startyear": 1928,
"endyear": 1929,
"id2": 50
},
{
"Sport": "Skeleton",
"id": 2,
"startyear": 1948,
"endyear": 1949,
"id2": 50
},
{
"Sport": "Skeleton",
"id": 3,
"startyear": 2002,
"endyear": 2014,
"id2": 50
},
{
"Sport": "Ski Jumping",
"id": 1,
"startyear": 1924,
"endyear": 1936,
"id2": 51
},
{
"Sport": "Ski Jumping",
"id": 2,
"startyear": 1948,
"endyear": 2014,
"id2": 51
},
{
"Sport": "Snowboarding",
"id": 1,
"startyear": 1998,
"endyear": 2014,
"id2": 52
},
{
"Sport": "Softball",
"id": 1,
"startyear": 1996,
"endyear": 2008,
"id2": 53
},
{
"Sport": "Speed Skating",
"id": 1,
"startyear": 1924,
"endyear": 1936,
"id2": 54
},
{
"Sport": "Speed Skating",
"id": 2,
"startyear": 1948,
"endyear": 2014,
"id2": 54
},
{
"Sport": "Swimming",
"id": 1,
"startyear": 1896,
"endyear": 1912,
"id2": 55
},
{
"Sport": "Swimming",
"id": 2,
"startyear": 1920,
"endyear": 1936,
"id2": 55
},
{
"Sport": "Swimming",
"id": 3,
"startyear": 1948,
"endyear": 2016,
"id2": 55
},
{
"Sport": "Synchronized Swimming",
"id": 1,
"startyear": 1984,
"endyear": 2016,
"id2": 56
},
{
"Sport": "Table Tennis",
"id": 1,
"startyear": 1988,
"endyear": 2016,
"id2": 57
},
{
"Sport": "Taekwondo",
"id": 1,
"startyear": 2000,
"endyear": 2016,
"id2": 58
},
{
"Sport": "Tennis",
"id": 1,
"startyear": 1896,
"endyear": 1912,
"id2": 59
},
{
"Sport": "Tennis",
"id": 2,
"startyear": 1920,
"endyear": 1924,
"id2": 59
},
{
"Sport": "Tennis",
"id": 3,
"startyear": 1988,
"endyear": 2016,
"id2": 59
},
{
"Sport": "Trampolining",
"id": 1,
"startyear": 2000,
"endyear": 2016,
"id2": 60
},
{
"Sport": "Triathlon",
"id": 1,
"startyear": 2000,
"endyear": 2016,
"id2": 61
},
{
"Sport": "Tug-Of-War",
"id": 1,
"startyear": 1900,
"endyear": 1912,
"id2": 62
},
{
"Sport": "Tug-Of-War",
"id": 2,
"startyear": 1920,
"endyear": 1921,
"id2": 62
},
{
"Sport": "Volleyball",
"id": 1,
"startyear": 1964,
"endyear": 2016,
"id2": 63
},
{
"Sport": "Water Polo",
"id": 1,
"startyear": 1900,
"endyear": 1912,
"id2": 64
},
{
"Sport": "Water Polo",
"id": 2,
"startyear": 1920,
"endyear": 1936,
"id2": 64
},
{
"Sport": "Water Polo",
"id": 3,
"startyear": 1948,
"endyear": 2016,
"id2": 64
},
{
"Sport": "Weightlifting",
"id": 1,
"startyear": 1896,
"endyear": 1897,
"id2": 65
},
{
"Sport": "Weightlifting",
"id": 2,
"startyear": 1904,
"endyear": 1906,
"id2": 65
},
{
"Sport": "Weightlifting",
"id": 3,
"startyear": 1920,
"endyear": 1936,
"id2": 65
},
{
"Sport": "Weightlifting",
"id": 4,
"startyear": 1948,
"endyear": 2016,
"id2": 65
},
{
"Sport": "Wrestling",
"id": 1,
"startyear": 1896,
"endyear": 1897,
"id2": 66
},
{
"Sport": "Wrestling",
"id": 2,
"startyear": 1904,
"endyear": 1912,
"id2": 66
},
{
"Sport": "Wrestling",
"id": 3,
"startyear": 1920,
"endyear": 1936,
"id2": 66
},
{
"Sport": "Wrestling",
"id": 4,
"startyear": 1948,
"endyear": 2016,
"id2": 66
}
]


var timeScale = d3.scaleTime()
.domain([d3.min(taskArray, function(d) {return d.startyear;}),
         d3.max(taskArray, function(d) {return (d.endyear);})])
         .range([0,w-150-150]);
         
         var categories = new Array();
         
         for (var i = 0; i < taskArray.length; i++){
             categories.push(taskArray[i].Sport);
         }

var catsUnfiltered = categories; //for vert labels

categories = checkUnique(categories);


makeGant(taskArray, w, h);

//var title = Sportssvg.append("text")
//.text("History of Olympic Sports")
//.attr("x", w/2)
//.attr("y", 55)
//.attr("text-anchor", "middle")
//.attr("font-size", 56)
//.attr("fill", "#000000");

function makeGant(tasks, pageWidth, pageHeight){
    
    var barHeight = 20;
    var gap = barHeight + 20;
    var topPadding = 10;
    var sidePadding = 300;
    
    var colorScale = d3.scaleLinear()
    .domain([0, categories.length])
    .range(["#00B9FA", "#F95002"])
    .interpolate(d3.interpolateHcl);
    
    makeGrid(sidePadding, topPadding, pageWidth, pageHeight);
    drawRects(tasks, gap, topPadding, sidePadding, barHeight, colorScale, pageWidth, pageHeight);
    vertLabels(tasks, gap, topPadding, sidePadding, barHeight, colorScale);
    
}

function drawRects(theArray, theGap, theTopPad, theSidePad, theBarHeight, theColorScale, w, h){
    
    
    var bigRects = Sportssvg.append("g")
    .selectAll("rect")
    .data(theArray)
    .enter()
    .append("rect")
    .attr("x", 0)
    .attr("y", function(d){
          return d.id2*theGap + theTopPad - 10;
          })
          .attr("width", function(d){
                return w + theSidePad + 150;
                })
                .attr("height", theGap)
                .attr("stroke", "none")
                .attr("fill", "#FFFFFF")
                
                var rectangles = Sportssvg.append('g')
                .selectAll("rect")
                .data(theArray)
                .enter();
                
                var div = d3.select("body").append("div")
                .attr("class", "tooltipSport")
                .style("opacity", 0);
                
                
                var innerRects = rectangles.append("rect")
                .attr("rx", 1)
                .attr("ry", 1)
                .attr("x", function(d){
                      return timeScale(d.startyear) + theSidePad;
                      })
                      .attr("y", function(d){
                            return d.id2*theGap + theTopPad;
                            })
                            .attr("width", function(d){
                                  return (timeScale(d.endyear)-timeScale(d.startyear));
                                  })
                                  .attr("height", theBarHeight)
                                  .attr("stroke", "none")
			.attr("fill", function(d) {

   				if (d.id2 % 2 == 0) {
                    			return '#6ac16e'
                			 }
                		else  {
                    			return '#207237';
               				 }
				})
                                  .on("mouseover", function(d) {
                                      div.transition().duration(200)
                                      .style("opacity", .9);
                                      div.html("Start:" +  d.startyear + "<br/>" + "End:" +  d.endyear)
                                      .style("left", d3.event.pageX + "px")
                                      .style("top", (d3.event.pageY - 28) + "px");
                                      })
                                      .on("mouseout", function(d) {
                                          div.transition()
                                          .duration(500)
                                          .style("opacity", 0);
                                          })
                                          
                                          
}


function makeGrid(theSidePad, theTopPad, w, h){
    
    var grid = Sportssvg.append('g')
    .attr('class', 'grid')
    .attr('transform', 'translate(' +theSidePad + ', ' + (h) + ')')
    .selectAll("text")
    .style("text-anchor", "middle")
    .attr("fill", "#000")
    .attr("stroke", "none")
    .attr("font-size", 10)
    .attr("dy", "1em");
}

function vertLabels(theArray, theGap, theTopPad, theSidePad, theBarHeight, theColorScale){
    var numOccurances = new Array();
    var prevGap = 0;
    
    for (var i = 0; i < categories.length; i++){
        numOccurances[i] = [categories[i], getCount(categories[i], catsUnfiltered)];
    }
    
    
    var axisText = Sportssvg.append("g") //without doing this, impossible to put grid lines behind text
    .selectAll("text")
    .data(theArray)
    .enter()
    .append("text")
    .text(function(d){
          return d.Sport;
          })
          .attr("x", 0)
          .attr("y", function(d){
                return d.id2*theGap + theTopPad + theBarHeight;
                })
                .attr("font-size", 24)
                .attr("text-anchor", "start")
                //.attr("fill", "#0000FF")
			.attr("fill", function(d) {
		
   				if (d.id2 % 2 == 0) {
                    			return '#6ac16e'
                			 }
                		else  {
                    			return '#207237';
               				 }
			})
}

//from this stackexchange question: http://stackoverflow.com/questions/1890203/unique-for-arrays-in-javascript
function checkUnique(arr) {
    var hash = {}, result = [];
    for ( var i = 0, l = arr.length; i < l; ++i ) {
        if ( !hash.hasOwnProperty(arr[i]) ) { //it works with objects! in FF, at least
            hash[ arr[i] ] = true;
            result.push(arr[i]);
        }
    }
    return result;
}

//from this stackexchange question: http://stackoverflow.com/questions/14227981/count-how-many-strings-in-an-array-have-duplicates-in-the-same-array
function getCounts(arr) {
    var i = arr.length, // var to loop over
    obj = {}; // obj to store results
    while (i) obj[arr[--i]] = (obj[arr[i]] || 0) + 1; // count occurrences
    return obj;
}

// get specific from everything
function getCount(word, arr) {
    return getCounts(arr)[word] || 0;
}

                  
/// DEMOGRAPICS ///
// Define margins, dimensions, and some line colors
// Define margins, dimensions, and some line colors
const marginDem = {top: 40, right: 150, bottom: 50, left: 50};
const widthDem = 900 - marginDem.left - marginDem.right;
const heightDem = 400 - marginDem.top - marginDem.bottom;

// Define the scales and tell D3 how to draw the line
const xDem = d3.scaleLinear().domain([1896, 2016]).range([0, widthDem]);
const yDem = d3.scaleLinear().domain([0, 1]).range([heightDem, 0]);
const lineDem = d3.line().x(d => xDem(d.Year)).y(d => yDem(d.Rate));

const chartDem = d3.select("#demo").append('g')
  .attr('transform', 'translate(' + marginDem.left + ',' + marginDem.top + ')');
  
const tooltipDem = d3.select('#tooltipDem');
const tooltipDemLine = chartDem.append('line');
  
// Add the axes and a title
const xAxisDem = d3.axisBottom(xDem).tickFormat(d3.format('.4'));
const yAxisDem = d3.axisLeft(yDem); //.tickFormat(d3.format('.1'))
chartDem.append('g').call(yAxisDem);
chartDem.append('g').attr('transform', 'translate(0,' + heightDem + ')').call(xAxisDem);
chartDem.append('text').html('Gender Rates in Olympic Games').attr('x', 230).attr("style", "font-family: sans-serif")
chartDem.append('text').html('Olympic Year').attr('x', 300).attr('y', 350).attr("style", "font-family: sans-serif");
  
// Load the data and draw a chart
let gendersDem, tipBoxDem;
d3.json('../data/demographics.json', d => {
  gendersDem = d;


  chartDem.selectAll()
    .data(gendersDem).enter()
    .append('path')
    .attr('fill', 'none')
    .attr('stroke', d => d.color)
    .attr('stroke-width', 2)
    .datum(d => d.history)
    .attr('d', lineDem);

  chartDem.selectAll()
    .data(gendersDem).enter()
    .append('text')
    .html(d => d.name)
    .attr("style", "font-family: sans-serif")
    .attr('fill', d => d.color)
    .attr('alignment-baseline', 'middle')
    .attr('x', widthDem+30)
    .attr('dx', '.5em')
    .attr('y', d => yDem(d.currentRate)); 
  
  tipBoxDem = chartDem.append('rect')
    .attr('width', widthDem)
    .attr('height', heightDem)
    .attr('opacity', 0)
    .on('mousemove', drawTooltipDem)
    .on('mouseout', removeTooltipDem);
})

function removeTooltipDem() {
  if (tooltipDem) tooltipDem.style('display', 'none');
  if (tooltipDemLine) tooltipDemLine.attr('stroke', 'none');
}

function drawTooltipDem() {
  const Year = Math.floor((xDem.invert(d3.mouse(tipBoxDem.node())[0])) / 1) * 1;
  
  gendersDem.sort((a, b) => {
    return b.history.find(h => h.Year == Year).Rate - a.history.find(h => h.Year == Year).Rate;
  })  
    
  tooltipDemLine.attr('stroke', 'black')
    .attr('x1', xDem(Year))
    .attr('x2', xDem(Year))
    .attr('y1', 0)
    .attr('y2', heightDem);
  
  tooltipDem.html(Year)
    .style('display', 'block')
    .style('left', d3.event.pageX + 20)
    .style('top', d3.event.pageY - 20)
    .selectAll()
    .data(gendersDem).enter()
    .append('div')
    .style('color', d => d.color)
    .attr("style", "font-family: sans-serif")
    .html(d => d.name + ': ' + Math.round(100*(d.history.find(h => h.Year == Year).Rate)) + '%');
}
////  WINTER VERSUS SUMMER////
//var widthW = window.innerWidth,
//heightW = window.innerHeight,
//centered,
//clicked_point;
var widthW=1100, heightW=550;
var projectionW = d3.geoMercator()
.translate([widthW / 2.2, heightW / 1.5])
.scale(130);

var plane_path = d3.geoPath()
.projection(projectionW);

var Wsvg = d3.select("#ws").append("svg")
.attr("width", widthW)
.attr("height", heightW)
//.attr("class", "map");
var gW = Wsvg.append('g');

var pathW = d3.geoPath()
.projection(projectionW);

var defs = Wsvg.append("defs");

//Append a linearGradient element to the defs and give it a unique id
var linearGradient = defs.append("linearGradient")
    .attr("id", "linear-gradient");
linearGradient
    .attr("x1", "0%")
    .attr("y1", "0%")
    .attr("x2", "0%")
    .attr("y2", "100%");
//Set the color for the start (0%)
linearGradient.selectAll("stop")
    .data([
        {offset: "0%", color: d3.interpolateRdBu(0)},
        {offset: "12.5%", color: d3.interpolateRdBu(0.125)},
        {offset: "25%", color: d3.interpolateRdBu(0.25)},
        {offset: "37.5%", color: d3.interpolateRdBu(0.375)},
        {offset: "50%", color: d3.interpolateRdBu(0.5)},
        {offset: "62.5%", color: d3.interpolateRdBu(0.625)},
        {offset: "75%", color: d3.interpolateRdBu(0.75)},
        {offset: "87.5%", color: d3.interpolateRdBu(0.875)},
        {offset: "100%", color: d3.interpolateRdBu(1)}
      ])
    .enter().append("stop")
    .attr("offset", function(d) { return d.offset; })
    .attr("stop-color", function(d) { return d.color; });

var text = ["100% won in Winter", "75% Winter", "Equal Medals", "75% Summer", "100% won in Summer"]
var the_y = d3.scalePoint()
      .range([299, 0])
      .domain(text.map(function(d) {return d } ) )
      //.nice();


var yAxis = d3.axisRight(the_y)
  .scale(the_y)
  .tickValues(the_y.domain());

Wsvg.append("rect")
    .attr("width", 15)
    .attr("height", 300)
    .attr("y", heightW - 450)
    .attr("x", widthW - 145)
    .style("fill", "url(#linear-gradient)")
    .attr("class", "legend");


Wsvg.append("rect")
    .attr("width", 15)
    .attr("height", 25)
    .attr("y", heightW - 100)
    .attr("x", widthW -145)
    .style("fill", "#D3D3D3")
    .attr("class", "nomedals");

var nomedaltext = ["No Medals Won"];
var nom_y = d3.scaleBand()
      .range([25, 0])
      .domain(nomedaltext.map(function(d) {return d } ) )
      //.nice();
var nomyAxis = d3.axisRight(nom_y)
  .scale(nom_y)
  .tickValues(nom_y.domain());

Wsvg.append("g")
      .attr("class", "y axis")
      .attr("transform", "translate(970,100)")
      .call(yAxis)
      .append("text")
      //.attr("transform", "rotate(-90)")
      //.attr("y", 0)
      //.attr("dy", ".71em")
      //.style("text-anchor", "end")
      //.tickValues(the_y.ticks( 5 ).concat(the_y.domain() ) )
      //.text("axis title");

Wsvg.append("g")
      .attr("class", "y axis")
      .attr("transform", "translate(970,450)")
      .call(nomyAxis)
      .append("text")

var box = d3.select("#ws")

box.append("text")
    .attr("x", 0)
    .attr("y", 350)
    .attr("dy", ".35em")
    .text("The percentage of medals won")
box.append("text")
	.attr("x", 0)
	.attr("y", 365)
    .attr("dy", ".35em")
    .text("corrects for the fact there are")
box.append("text")
	.attr("x", 0)
	.attr("y", 380)
    .attr("dy", ".35em")
    .text("16,052 total summer medals and")
box.append("text")
	.attr("x", 0)
	.attr("y", 395)
    .attr("dy", ".35em")
    .text("only 2,853 winter medals. The percentage")
box.append("text")
	.attr("x", 0)
	.attr("y", 410)
    .attr("dy", ".35em")
    .text("won is compared to the expected percent.")

// Reading in data here, then calling "ready" function:
d3.csv("../data/winter_vs_summer2.csv", ready)
// Ready Function
function ready(error, data) {
    
    if (error) return console.warn(error);
    
    var max = d3.max(data, function(d) { return d.amt_above_exp_sum_pct; });
    var min = d3.min(data, function(d) { return d.amt_above_exp_sum_pct; });
    // formatting data
    data.forEach(function(d) {
     d.id = d['id'];
     d.region = d['region'];
     d.pct = +d.amt_above_exp_sum_pct;
     d.blueorange = 1-( (+d.amt_above_exp_sum_pct - min) / (max - min))
     d.color = d3.interpolateRdBu(d.blueorange)
     d.summer_cnt = +d.Summer;
     d.winter_cnt = +d.Winter;
     d.never_won = +d.never_won;
     });
                 
     var arr=[];
     data.forEach(function(i){
                  arr[i.id]=i.region; });
                  
      //These countries have won medals
     var participating_countries = data.filter(function(d) { return d.never_won == 0;}).map(function(d) {return d.id; });
      
      
      //These countries have never won medals.
      var never_won = ["008", "016", "020", "024", "028", "533", "050", "084", "204", "064", "068", "070", "096", "854", "116", "132", "136", "140", "148",
                       "174", "184", "180", "212", "222", "226", "270", "316", "324", "624", "340", "296", "418", "426", "430", "434", "450", "454", "462",
                       "466", "470", "584", "478", "583", "104", "520", "558", "512", "585", "275", "598", "178", "646", "659", "662", "670", "882", "674",
                       "678", "690", "694", "90", "706", "728", "748", "626", "795", "798", "548", "92", "887"]
                       
                                               
       // load and display the World
       d3.json("https://unpkg.com/world-atlas@1/world/110m.json", function(error, topology) {
               var geojson = topojson.feature(topology, topology.objects.countries);
               gW.selectAll("path")
               .data(geojson.features)
               .enter()
               .append("path")
               .attr("d", pathW);
               gW.selectAll('path')
               .attr('fill', colorCountry)
               .call(d3.helper.tooltip(
                  function(d){
                  return "<b>"+arr[d.id]+ "</b>";
                  }
                 ));
        });
        
       // add color to countries
       function colorCountry(country) {
           var id = country.id;
           if (id == 10) {
               return '#FFFFFF'
           }
           else if (never_won.includes(country.id)) {
               return '#D3D3D3';
           }
           else if (participating_countries.includes(country.id)){
               for (var i = 0; i < data.length; i++) {
                   var dataId = data[i].id;
                   if(dataId== id){
                       return data[i].color;
                   }}}
           else {
               return '#D3D3D3'
           }
        };
                                                       
                                                       
};
//// ATHLETE BODY COMPOSITION //////
var labelsBox = true; // show the text labels beside individual boxplots?
var marginBox = {top: 30, right: 50, bottom: 70, left: 50};
var  widthBox = 800 - marginBox.left - marginBox.right;
var heightBox = 400 - marginBox.top - marginBox.bottom;
  
var minBox = Infinity,
    maxBox = -Infinity;
// parse in the data  
d3.csv("../data/athlete_profile.csv", readyBox)
function readyBox(error, csv) {
  var Asvg = d3.select("#athlete").append("svg")
      .attr("width", widthBox + marginBox.left + marginBox.right)
      .attr("height", heightBox + marginBox.top + marginBox.bottom)
      .attr("class", "box")    
      .append("g")
      .attr("id", "parentG")
      .attr("transform", "translate(" + marginBox.left + "," + marginBox.top + ")");
  var namesBox = ["Sport 1: Alpine Skiing","Sport 2: Alpine Skiing"]
  var xBox = d3.scaleBand()    
        .domain( namesBox.map(function(d) {return d } ) )     
        .range([0 , widthBox], 0.7, 0.3);   
  var yBox = d3.scaleLinear()
        .domain([minBox, maxBox])
        .range([heightBox + marginBox.top, 0 + marginBox.top]);
  var xAxisBox = d3.axisBottom(xBox);
      // the y-axis
      
      
  var yAxisBox = d3.axisLeft(yBox);
  var sportMenu1 = d3.select("#Dropdown1Box")
  var nest = d3.nest()
    .key(function(d){
      return d.Sport;
    }).sortKeys(d3.ascending)
    .entries(csv)
    sportMenu1
    .append("select")
    .attr("id","select1")
    .selectAll("option")
        .data(nest)
        .enter()
        .append("option")
        .attr("value", function(d){
            return d.key;
        })
        .text(function(d){
            return d.key;
        })
    var sportMenu2 = d3.select("#Dropdown2Box")
  var nest = d3.nest()
    .key(function(d){
      return d.Sport;
    }).sortKeys(d3.ascending)


    .entries(csv)
    sportMenu2
    .append("select")
    .attr("id","select2")
    .selectAll("option")
        .data(nest)
        .enter()
        .append("option")
        .attr("value", function(d){
            return d.key;
        })
        .text(function(d){
            return d.key;
        })

    var attributes = ["Height","Weight","Age"]

    var sportMenu3 = d3.select("#Dropdown3Box")
    sportMenu3
    .append("select")
    .attr("id","select3")
    .selectAll("option")
        .data(attributes)
        .enter()
        .append("option")
        .attr("value", function(d){
            return d;
        })
        .text(function(d){
            return d;
        })


  var initialGraph = function(Sport1,Sport2,sportMetric){
    minBox = Infinity,
      maxBox = -Infinity;

    var filterdata1 = csv.filter(function(d) { if( d["Sport"] == Sport1) 
        { return d; }})
        var filterdata2 = csv.filter(function(d) { if( d["Sport"] == Sport2) 
        { return d; }})





    var data = [];
    data[0] = [];
    data[1] = [];
    
    data[0][0] = "Sport 1: Alpine Skiing";
    data[0][1] = [];
    data[1][0] = "Sport 2: Alpine Skiing";
    data[1][1] = [];

    if ("Age" == sportMetric) {
    filterdata1.forEach(function(x) {
      var v1 = Math.floor(x.Age);
        // add more variables if your csv file has more columns
        
      var rowMax = Math.max(v1);
      var rowMin = Math.min(v1);
      data[0][1].push(v1);

       // add more rows if your csv file has more columns
       
      if (rowMax > maxBox) maxBox = rowMax;
      if (rowMin < minBox) minBox = rowMin; 
    });

    filterdata2.forEach(function(x) {
      var v2 = Math.floor(x.Age);
        // add more variables if your csv file has more columns
        
      var rowMax2 = Math.max(v2);
      var rowMin2 = Math.min(v2);
      data[1][1].push(v2);

       // add more rows if your csv file has more columns
       
      if (rowMax2 > maxBox) maxBox = rowMax2;
      if (rowMin2 < minBox) minBox = rowMin2; 
    });
    }
    else if ("Weight" == sportMetric) {
    filterdata1.forEach(function(x) {
      var v1 = Math.floor(x.Weight);
        // add more variables if your csv file has more columns
        
      var rowMax = Math.max(v1);
      var rowMin = Math.min(v1);
      data[0][1].push(v1);

       // add more rows if your csv file has more columns
       
      if (rowMax > maxBox) maxBox = rowMax;
      if (rowMin < minBox) minBox = rowMin; 
    });

    filterdata2.forEach(function(x) {
      var v2 = Math.floor(x.Weight);
        // add more variables if your csv file has more columns
        
      var rowMax2 = Math.max(v2);
      var rowMin2 = Math.min(v2);
      data[1][1].push(v2);

       // add more rows if your csv file has more columns
       
      if (rowMax2 > maxBox) maxBox = rowMax2;
      if (rowMin2 < minBox) minBox = rowMin2; 
    });
    }
    else if ("Height" == sportMetric) {
    filterdata1.forEach(function(x) {
      var v1 = Math.floor(x.Height);
        // add more variables if your csv file has more columns
        
      var rowMax = Math.max(v1);
      var rowMin = Math.min(v1);
      data[0][1].push(v1);

       // add more rows if your csv file has more columns
       
      if (rowMax > maxBox) maxBox = rowMax;
      if (rowMin < minBox) minBox = rowMin; 
    });

    filterdata2.forEach(function(x) {
      var v2 = Math.floor(x.Height);
        // add more variables if your csv file has more columns
        
      var rowMax2 = Math.max(v2);
      var rowMin2 = Math.min(v2);
      data[1][1].push(v2);

       // add more rows if your csv file has more columns
       
      if (rowMax2 > maxBox) maxBox = rowMax2;
      if (rowMin2 < minBox) minBox = rowMin2; 
    });
    }

    var chart = d3.box()
      .whiskers(iqr(1.5))
      .height(heightBox)  
      .domain([minBox, maxBox])
      .showLabels(labelsBox);


      // draw the boxplots  
      Asvg.selectAll(".box")     
           .data(data)
        .enter().append("g")
        .attr("class","finalThing")
        .attr("transform", function(d) { return "translate(" +  (xBox(d[0]) + 160) + "," + marginBox.top + ")"; } )
           .call(chart.width(xBox.range()));
          // .attr("transform", 'translate (0,40)'); 
    







      // add a title
      Asvg.append("text")
             .attr("x", (widthBox / 2))             
             .attr("y", 0 + (marginBox.top / 2))
             .attr("text-anchor", "middle")  
             .style("font-size", "18px") 
             //.style("text-decoration", "underline")  
             .text(sportMetric)
             .attr("class", "title");
      
       // draw y axis
      Asvg.append("g")
             .attr("class", "y axis")
             .call(yAxisBox)
        .append("text") // and text1
          .attr("transform", "rotate(-90)")
          .attr("y", 6)
          .attr("dy", ".71em")
          .style("text-anchor", "end")
          .style("font-size", "16px") 
          .text("Revenue");   
      
      // draw x axis  
      Asvg.append("g")
            .attr('id','xAxisBoxId')
           .attr("class", "x axis")
           .attr("transform", "translate(0," + (heightBox  + marginBox.top + 10) + ")")
           .call(xAxisBox)
        .append("text")             // text label for the x axis
             .attr("x", (widthBox / 2) )
             .attr("y",  10 )
        .attr("dy", ".71em")
             .style("text-anchor", "middle")
        .style("font-size", "16px") 
             .text("Quarter"); 

        d3.select("#xAxisBoxId").selectAll("text").attr("id", function(d,i) {return "axisText" + i});

              
  }
  // Create initial graph
  initialGraph("Alpine Skiing","Alpine Skiing","Height")

  // Run update function when dropdown selection changes
  sportMenu1.on('change', function(){
    // Find which fruit was selected from the dropdown
    var firstSport = document.getElementById('select1').options[document.getElementById('select1').selectedIndex].value;
    var secondSport = document.getElementById('select2').options[document.getElementById('select2').selectedIndex].value;
    var sportMetric = document.getElementById('select3').options[document.getElementById('select3').selectedIndex].value;
        // Run update function with the selected fruit
    var myNode = document.getElementById("parentG");
    while (myNode.firstChild) {
        myNode.removeChild(myNode.firstChild);
    }
  // code block to be executed
//}
        initialGraph(firstSport,secondSport,sportMetric)
        d3.select("#axisText0").text("Sport 1: " + firstSport)
        d3.select("#axisText1").text("Sport 2: " + secondSport)
    });

     sportMenu2.on('change', function(){
    // Find which fruit was selected from the dropdown
    var firstSport = document.getElementById('select1').options[document.getElementById('select1').selectedIndex].value;
    var secondSport = document.getElementById('select2').options[document.getElementById('select2').selectedIndex].value;
    var sportMetric = document.getElementById('select3').options[document.getElementById('select3').selectedIndex].value;
        // Run update function with the selected fruit
    var myNode = document.getElementById("parentG");
    while (myNode.firstChild) {
        myNode.removeChild(myNode.firstChild);
    }
    initialGraph(firstSport,secondSport,sportMetric)
    d3.select("#axisText0").text("Sport 1: " + firstSport)
    d3.select("#axisText1").text("Sport 2: " + secondSport)
});
     sportMenu3.on('change', function(){
    // Find which fruit was selected from the dropdown
    var firstSport = document.getElementById('select1').options[document.getElementById('select1').selectedIndex].value;
    var secondSport = document.getElementById('select2').options[document.getElementById('select2').selectedIndex].value;
    var sportMetric = document.getElementById('select3').options[document.getElementById('select3').selectedIndex].value;
        // Run update function with the selected fruit
    var myNode = document.getElementById("parentG");
    while (myNode.firstChild) {
        myNode.removeChild(myNode.firstChild);
    }
        initialGraph(firstSport,secondSport,sportMetric)
        d3.select("#axisText0").text("Sport 1: " + firstSport)
        d3.select("#axisText1").text("Sport 1: " + secondSport)
    });
}
// Returns a function to compute the interquartile range.
function iqr(k) {
  return function(d, i) {
    var q1 = d.quartiles[0],
        q3 = d.quartiles[2],
        iqr = (q3 - q1) * k,
        i = -1,
        j = d.length;
    while (d[++i] < q1 - iqr);
    while (d[--j] > q3 + iqr);
    return [i, j];
  };
}
</script>
